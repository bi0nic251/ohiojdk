<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>J.A.R.V.I.S. Terminal</title>
<style>
    body {
        margin: 0;
        background-color: #000;
        font-family: "Courier New", monospace;
        color: #0ff; /* bright cyan */
    }
    #terminal {
        padding: 20px;
        height: 100vh;
        overflow-y: auto;
        white-space: pre-wrap;
        line-height: 1.4;
        box-sizing: border-box;
        border: 4px solid #0ff; /* terminal border */
    }
    .input-line {
        display: inline;
    }
    .cursor {
        display: inline-block;
        width: 10px;
        background-color: #0ff;
        animation: blink 1s steps(2, start) infinite;
        vertical-align: bottom;
    }
    @keyframes blink {
        0%, 50% { opacity: 1; }
        50.01%, 100% { opacity: 0; }
    }
    #fandom-frame {
        width: 100%;
        height: 50vh;
        border: 2px solid #0ff;
        margin-top: 10px;
    }
    #suit-panel {
        margin-top: 10px;
        padding: 10px;
        border: 2px solid #0ff;
    }
    #suit-panel img {
        max-width: 200px;
    }
</style>
</head>
<body>
<div id="terminal"></div>

<script>
const terminal = document.getElementById("terminal");
const password = "!ronmanRox95";
let state = "login";
let attempts = 3;
let inputLine, cursor, userInput = "";

// Initial prompt
function showPrompt() {
    inputLine = document.createElement("span");
    inputLine.classList.add("input-line");
    inputLine.textContent = state === "login" ? "Enter Access Password: " : "J.A.R.V.I.S> ";
    cursor = document.createElement("span");
    cursor.classList.add("cursor");
    terminal.appendChild(inputLine);
    terminal.appendChild(cursor);
    scrollTerminal();
}
showPrompt();

// Handle typing
document.addEventListener("keydown", (e) => {
    if (!cursor) return;
    if (e.key === "Backspace") {
        if (userInput.length > 0) {
            userInput = userInput.slice(0, -1);
            inputLine.textContent = (state === "login" ? "Enter Access Password: " : "J.A.R.V.I.S> ") + userInput;
        }
        e.preventDefault();
    } else if (e.key === "Enter") {
        processInput(userInput);
        userInput = "";
    } else if (e.key.length === 1) {
        userInput += e.key;
        inputLine.textContent = (state === "login" ? "Enter Access Password: " : "J.A.R.V.I.S> ") + userInput;
    }
    scrollTerminal();
});

function processInput(input) {
    // Remove current input line
    cursor.remove();
    inputLine.remove();
    
    const line = document.createElement("div");
    line.textContent = (state === "login" ? "Enter Access Password: " : "J.A.R.V.I.S> ") + input;
    terminal.appendChild(line);
    
    if (state === "login") {
        if (input === password) {
            state = "loading";
            showLoading();
        } else {
            attempts--;
            const error = document.createElement("div");
            if (attempts <= 0) {
                error.textContent = "ACCESS DENIED - UNAUTHORIZED USER. TERMINATING SESSION.";
                terminal.appendChild(error);
                return;
            } else {
                error.textContent = `ACCESS DENIED - ${attempts} attempts remaining`;
            }
            terminal.appendChild(error);
            showPrompt();
        }
    } else if (state === "terminal") {
        handleCommand(input);
        showPrompt();
    }
}

// Loading animation
function showLoading() {
    const frames = ["[    ]", "[=   ]", "[==  ]", "[=== ]", "[====]", "[ ===]", "[  ==]", "[   =]", "[    ]"];
    let idx = 0;
    const msg = document.createElement("div");
    terminal.appendChild(msg);
    const interval = setInterval(() => {
        msg.textContent = `[Connecting to Stark Secure Server] ${frames[idx % frames.length]}`;
        idx++;
        scrollTerminal();
    }, 200);
    setTimeout(() => {
        clearInterval(interval);
        msg.textContent = "[Authentication accepted]\n[Loading system protocols...]\n[J.A.R.V.I.S. systems online]";
        state = "terminal";
        // Embed Fandom page and suit panel
        addFandom();
        addSuitPanel();
        showPrompt();
    }, 3000);
}

function handleCommand(cmd) {
    const output = document.createElement("div");
    if (cmd.toLowerCase() === "exit") {
        output.textContent = "Shutting down systems...";
        terminal.appendChild(output);
        return;
    } else if (cmd.toLowerCase() === "favsuit") {
        output.textContent = "Displaying Mark VI Suit Panel...";
        terminal.appendChild(output);
        return;
    } else {
        output.textContent = `Command '${cmd}' not recognized.`;
        terminal.appendChild(output);
    }
}

function scrollTerminal() {
    terminal.scrollTop = terminal.scrollHeight;
}

// Embed Fandom offline (use iframe to local copy if offline)
// For this demo, we load the online version:
function addFandom() {
    const iframe = document.createElement("iframe");
    iframe.id = "fandom-frame";
    iframe.src = "https://marvelcinematicuniverse.fandom.com/wiki/Iron_Man_Armor:_Mark_VI";
    terminal.appendChild(iframe);
}

// Suit panel
function addSuitPanel() {
    const panel = document.createElement("div");
    panel.id = "suit-panel";
    const img = document.createElement("img");
    img.src = "https://upload.wikimedia.org/wikipedia/en/7/7f/Iron_Man_Mark_6.png"; // Mark VI image
    const info = document.createElement("div");
    info.textContent = "Mark VI Suit: Ready for deployment.";
    panel.appendChild(img);
    panel.appendChild(info);
    terminal.appendChild(panel);
}
</script>
</body>
</html>
